<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ø¨ÙŠØªÙƒÙˆÙŠÙ† ÙƒØ§Ø´ - Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
<link rel="stylesheet" href="style.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase.js"></script>
<script src="app.js"></script>
</head>
<body>
<div class="header">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>

<div class="container">
  <div class="card">
    <div class="row">
      <div class="small" id="me">ğŸ‘¤ ...</div>
      <button class="btn btn-ghost" style="min-height:auto;padding:10px 12px;margin-top:0" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
    </div>

    <div class="kpi" style="margin-top:12px">
      <div class="box"><div class="num" id="points">0</div><div class="cap">Ø§Ù„Ù†Ù‚Ø§Ø·</div></div>
      <div class="box"><div class="num" id="balance">$0.00</div><div class="cap">Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</div></div>
    </div>

    <button class="btn btn-green" onclick="convert()">ğŸ’± ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¥Ù„Ù‰ Ø¯ÙˆÙ„Ø§Ø±</button>
    <a href="withdraw.html" class="btn btn-blue" style="display:block;text-align:center;text-decoration:none;line-height:24px">ğŸ“¤ Ø·Ù„Ø¨ Ø³Ø­Ø¨</a>
    <a href="admin.html" id="adminLink" class="btn btn-gold" style="display:none;text-align:center;text-decoration:none;line-height:24px">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</a>

    <p class="status" id="status"></p>
    <p class="small">ÙƒÙ„ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¥Ø¹Ù„Ø§Ù† = 3 Ù†Ù‚Ø§Ø· â€¢ ÙƒÙ„ Ù†Ù‚Ø·Ø© = 1 Ø¯ÙˆÙ„Ø§Ø±</p>
  </div>

  <div class="card">
    <div class="small">âš¡ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ (ØªØ£ÙƒÙŠØ¯ ÙŠØ¯ÙˆÙŠ)</div>
    <div class="row">
      <a class="btn btn-gold" href="payment-proof.html?amount=10">$10</a>
      <a class="btn btn-gold" href="payment-proof.html?amount=50">$50</a>
    </div>
    <div class="row">
      <a class="btn btn-gold" href="payment-proof.html?amount=100">$100</a>
      <a class="btn btn-gold" href="payment-proof.html?amount=200">$200</a>
    </div>
    <a class="btn btn-gold" href="payment-proof.html?amount=500">$500</a>
  </div>
</div>

<div class="nav">
  <a href="home.html" data-nav="home" class="active"><span class="ico">ğŸ </span><small>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</small></a>
  <a href="ads.html" data-nav="ads"><span class="ico">ğŸ“º</span><small>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</small></a>
  <a href="wallet.html" data-nav="wallet"><span class="ico">ğŸ’¼</span><small>Ø§Ù„Ù…Ø­ÙØ¸Ø©</small></a>
  <a href="about.html" data-nav="about"><span class="ico">â„¹ï¸</span><small>Ù…Ù† Ù†Ø­Ù†</small></a>
</div>

<script>
setNav("home");
async function load(){
  const s = await requireAuth(); if(!s) return;
  document.getElementById("me").textContent="ğŸ‘¤ "+(s.user.email||"Ù…Ø³ØªØ®Ø¯Ù…");

  const p = await supabase.from("user_points").select("points").eq("user_id", s.user.id).maybeSingle();
  if(p.data) document.getElementById("points").textContent = p.data.points ?? 0;

  const b = await supabase.from("user_balance").select("balance").eq("user_id", s.user.id).maybeSingle();
  if(b.data) document.getElementById("balance").textContent = "$"+(b.data.balance??0);

  if(await isAdminEmail()) document.getElementById("adminLink").style.display="block";
}
load();

async function convert(){
  const { error } = await supabase.rpc("convert_points_to_balance");
  document.getElementById("status").textContent = error ? ("Ø®Ø·Ø£: "+error.message) : "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ âœ…";
  load();
}
</script>
</body>
</html>
